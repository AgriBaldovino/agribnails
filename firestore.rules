rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Reglas de desarrollo: permiten leer y escribir en /clients
    match /clients/{docId} {
      allow read, write: if true;
    }

    // Settings (precios):
    // - lectura pública (clientas pueden ver precios)
    // - escritura solo autenticadas (admin)
    match /settings/{document=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    // Turnos disponibles:
    // - lectura pública (clientas pueden ver turnos)
    // - escritura solo autenticadas (admin)
    // - PERMITIR actualización del campo 'disponible' cuando se crea una reserva
    match /slots/{docId} {
      allow read: if true;
      allow write: if request.auth != null;
      // Permitir actualización solo del campo 'disponible' para marcar turnos como no disponibles
      allow update: if request.auth != null || 
        (request.method == 'update' && 
         request.resource.data.diff(resource.data).affectedKeys().hasOnly(['disponible', 'updatedAt']));
    }

    // Reservas de turnos:
    // - lectura y escritura públicas (clientas pueden reservar)
    match /bookings/{docId} {
      allow read, write: if true;
    }
  }
}


